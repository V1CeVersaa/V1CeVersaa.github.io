# Verilog

## Chapter 1 Basic Knowledge

### 1.1 FPGA

**FPGA/Field Programmable Gate Array/现场可编程门阵列**：FPGA器属于专用集成电路/ASIC的一种半定制电路，是可以编程的逻辑列阵，可以按照设计人员的需求配置指定的电路结构，让客户不必依赖于芯片制造商设计和制造的专用集成电路就可以实现所需要的功能，同时实现非常高效的逻辑运算。其基本结构包括可编程输入输出单元，可配置逻辑块，数字时钟管理模块，嵌入式块RAM，布线资源，内嵌专用硬核，底层内嵌功能单元。

### 1.2 Verilog

Verilog HDL是一种硬件描述语言，用于从算法级、门级到开关级的多种抽象设计层次的数字系统建模。Verilog HDL提供了编程语言接口，通过这个接口可以在模拟、验证期间从设计外部访问设计，包括模拟的具体控制和运行。


### 1.3 数字电路

根据逻辑电路的不同特点，数字电路可以分为**组合逻辑**和**时序逻辑**。其中：

- 组合逻辑的特点是在任意时刻，模块的**输出仅仅取决于此时刻的输入**，与电路原本的状态无关。电路逻辑中不牵涉边沿信号的处理，也没有记忆性。
- 时序逻辑的特点是在任意时刻，模块的输出不仅取决于此时刻的输入，而且**还和电路原来的状态有关**。电路里面有存储元件用于保存信息。**一般仅当时钟的边沿到达时**，电路内部存储的信息才有可能发生变化。

```Verilog
module main(
    input I0,
    input I1.
    input I2,
    output O
);
```

**wire**的电器特性：

- wire必须被**有且仅有**一个`assign`输入；
- wire可以有0个或者多个`assign`输出.

## Chapter 2 Basic Syntax

### 2.1 数值系统

Verilog 这种硬件描述语言都基于基本的硬件逻辑之上，因此 Verilog 具有一套独特的基于电平逻辑的数值系统，使用下面四种基本数值表示电平逻辑：

- 0：表示低电平或者 False；
- 1：表示高电平或者 True；
- X：表示电平未知，实际情况可能是高电平或者低电平，甚至都不是；
- Z：表示高阻态，这种情况就是来源于信号没有驱动.

我们还经常用到整数，可以**简单使用十进制表示**，也可以使用**立即数**表示，基于如下的基数规则表示:`<bits>'<radix><value>`，其中 `<bits>` 表示二进制位宽，空缺不填就会根据后边的数值自动分配；`<radix>` 表示进制， `<radix>` 可以是 b/o/d/h，分别是二进制，八进制，十进制以及十六进制；`<value>` 表示数值，插入下划线 `_` 可以有效提升可读性。

### 2.2 标识符与变量类型

- **`wire`**
  用于声明线网型数据。`wire` 本质上对应着一根没有任何其他逻辑的导线，仅仅将输入自身的信号原封不动地传递到输出端。该类型数据用来表示以 `assign` 语句内赋值的组合逻辑信号，其默认初始值是 Z（高阻态）。

  `wire` 是 Verilog 的**默认数据类型**。也就是说，对于没有显式声明类型的信号，Verilog 一律将其默认为 `wire` 类型。

- **`reg`**
  用于声明在 `always` 语句内部进行赋值操作的信号。一般而言，`reg` 型变量对应着一种存储单元，其默认初始值是 X（未知状态）。为了避免可能的错误，凡是在 `always` 语句内部被赋值的信号，都应该被定义成 `reg` 类型。

  如果 `always` 描述的是组合逻辑，那么 `reg` 就会综合成一根线，如果 `always` 描述的是时序逻辑，那么 `reg` 才会综合成一个寄存器。

### 2.3 运算符

按位运算符：

- `&`：按位与；
- `|`：按位或；
- `^`：按位异或；
- `~`：按位取反；
- `~^` 或者 `^~`：按位同或；
- **Note**：如果运算符的两个操作数位宽不相等，则利用 0 向左扩展补充较短的操作数.

算数运算符：

### 2.4 模块：结构与例化

Verilog 的基本单元就是**模块**，模块是具有输入输出端口的逻辑块，可以代表一个物理器件，也可以代表一个复杂的逻辑系统，比如基础逻辑门器件或者通用的逻辑单元。一个数字电路系统一般由一个或者多个模块组成，模块化设计将总的逻辑功能分块实现，通过模块之间的互联关系实现所需要的整体系统需求。

#### 2.4.1 模块结构

所有模块以关键词 `module` 开始，以关键词 `endmodule` 结束，从 `module` 开始到第一个分号的部分是**模块声明**，类似于 C 中的函数声明，包括了模块名称、参数列表与输入输出口列表。模块内部可以包括内部变量声明、数据流赋值语句 `assign`、过程赋值语句 `always` 以及底层模块例化。

**端口**是模块与外界交互的接口，对于外部环境来说，模块内部的信号与逻辑都是不可见的，端口的存在允许我们将端口视为一个黑盒，只需要正确链接端口并且了解模块作用，而不需要关心模块内部实现细节。端口的类型有三种：输入端口 `input`，输出端口 `output`，和双向端口 `inout`。端口会被默认声明为 `wire` 类型，如果声明为 `reg` 类型就不能省略对应的 `reg` 声明。

模块名与模块输入输出列表之间可以加入形如 `#(parameter 参数=默认值)` 的**参数列表**，参数可以有多个，拿逗号隔开，可以提供默认值也可以不提供默认值。

下面举个小小的例子，模块内部的内容就省略了吧：

```verilog
module example #(
    parameter LENGTH = 32,
    parameter TIMES = 8
)(
    input [LENGTH-1:0] a,
    input reg rs1, rs2,
    output [LENGTH-1:0] s
);
```

### 2.5 Verilog 语句

#### 2.5.1 连续赋值 `assign`

#### 2.5.2 过程赋值 `always`/`initial`

除了直接使用信号作为敏感变量，Verilog 还支持通过使用 `posedge` 和 `negedge` 关键字将电平变化作为敏感变量。其中 `posedge` 对应上升沿，`negedge` 对应下降沿。我们将电平从低电平变成高电平的时刻称为**上升沿**，从高电平变为低电平的时刻称为**下降沿**.

#### 2.5.3 阻塞赋值与非阻塞赋值

- 阻塞赋值

  阻塞赋值是顺序执行的，即下一条语句执行前，当前语句一定会执行完毕。这与 C 语言的赋值思想是一致的。阻塞赋值语句使用等号 = 作为赋值符。

- 非阻塞赋值

  非阻塞赋值属于并行执行语句，即下一条语句的执行和当前语句的执行是同时进行的，它不会阻塞位于同一个语句块中后面语句的执行。非阻塞赋值语句使用小于等于号 <= 作为赋值符。

#### 2.5.4 `generate`语句

